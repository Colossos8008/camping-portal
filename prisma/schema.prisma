// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum PlaceType {
  STELLPLATZ
  CAMPINGPLATZ
  SEHENSWUERDIGKEIT
  HVO_TANKSTELLE
}

enum TSValue {
  STIMMIG
  OKAY
  PASST_NICHT
}

enum TSHaltung {
  DNA
  EXPLORER
}

enum TS21Source {
  AI
  USER
}

model Place {
  id               Int       @id @default(autoincrement())
  name             String
  type             PlaceType @default(CAMPINGPLATZ)
  lat              Float
  lng              Float

  dogAllowed       Boolean   @default(false)
  sanitary         Boolean   @default(false)
  yearRound        Boolean   @default(false)
  onlineBooking    Boolean   @default(false)
  gastronomy       Boolean   @default(false)

  thumbnailImageId Int?
  thumbnailImage   Image?    @relation("PlaceThumbnail", fields: [thumbnailImageId], references: [id], onDelete: SetNull)

  // TS 1 (alt) - bleibt bestehen
  ratingDetail     PlaceRating?

  // TS 2 (Haltung) - bleibt bestehen
  ts2              PlaceTS2?

  // TS 2.1 (neu) - additiv
  ts21             PlaceTS21?

  images           Image[]

  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @default(now()) @updatedAt
}

model PlaceRating {
  id              Int     @id @default(autoincrement())

  placeId         Int     @unique
  place           Place   @relation(fields: [placeId], references: [id], onDelete: Cascade)

  tsUmgebung      TSValue @default(OKAY)
  tsPlatzStruktur TSValue @default(OKAY)
  tsSanitaer      TSValue @default(OKAY)
  tsBuchung       TSValue @default(OKAY)
  tsHilde         TSValue @default(OKAY)
  tsPreisLeistung TSValue @default(OKAY)
  tsNachklang     TSValue @default(OKAY)

  totalPoints     Int     @default(7)

  note            String  @default("")
  cUmgebung       String  @default("")
  cPlatzStruktur  String  @default("")
  cSanitaer       String  @default("")
  cBuchung        String  @default("")
  cHilde          String  @default("")
  cPreisLeistung  String  @default("")
  cNachklang      String  @default("")

  createdAt       DateTime @default(now())
  updatedAt       DateTime @default(now()) @updatedAt
}

model PlaceTS2 {
  id         Int       @id @default(autoincrement())

  placeId    Int       @unique
  place      Place     @relation(fields: [placeId], references: [id], onDelete: Cascade)

  haltung    TSHaltung @default(DNA)

  // Optional - Freitext für TS 2.0 Kontext - komplett additiv
  note       String    @default("")

  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @default(now()) @updatedAt
}

model PlaceTS21 {
  id              Int        @id @default(autoincrement())

  placeId         Int        @unique
  place           Place      @relation(fields: [placeId], references: [id], onDelete: Cascade)

  // UI Toggle Persistenz - damit "Wir" nicht zurückspringt
  activeSource    TS21Source @default(AI)

  // Jsonb - flexibel, ohne Schema Explosion
  // Expected shape:
  // { "1a": "O", "1b": "S", ... }  (values: "S" | "O" | "X")
  ai              Json       @default(dbgenerated("'{}'::jsonb"))
  user            Json       @default(dbgenerated("'{}'::jsonb"))

  // NEU - TS DNA - Explorer (mutual exclusive in UI - DB erlaubt beides, UI hält es sauber)
  dna             Boolean    @default(false)
  explorer        Boolean    @default(false)
  dnaExplorerNote String     @default("")

  // Optional: Freitext / Kontext
  note            String     @default("")

  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @default(now()) @updatedAt
}

model Image {
  id           Int      @id @default(autoincrement())

  placeId      Int
  place        Place    @relation(fields: [placeId], references: [id], onDelete: Cascade)

  filename     String

  thumbnailFor Place[]  @relation("PlaceThumbnail")

  createdAt    DateTime @default(now())
  updatedAt    DateTime @default(now()) @updatedAt

  @@index([placeId])
}